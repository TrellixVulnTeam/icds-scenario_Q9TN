<!doctype html>
<html lang='en'>
	<head>
	    <title>Seroprevalence in Nigeria</title>
        <meta name='viewport' content='width=device-width, initial-scale=1, minimum-scale=1, maximum-scale=1, user-scalable=no'>
        <meta charset='utf-8'>
        <meta http-equiv='X-UA-Compatible' content='IE=edge,chrome=1'>
        <style>
			html, body {
				height: 100%;
			}
			body {
				/*background-color: #2c7fb8;*/
				/*background-color: black;*/
				color: #2e2e2e;
				margin: 0;
			}
			p, ul, ol {
				line-height: 2rem;
				font-family: 'Newsreader', serif;
				font-weight: 300;
				/*font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell, "Helvetica Neue", sans-serif;*/
				font-size: 1.4rem;
			}
			#header-hero {
				background-color: black;
				display: flex;
				justify-content: center;
				align-items: center;
				height: 100%;
			}
			header {
				text-align: center;
			}
			header h1 {
				/*color: #2c7fb8;*/
				color: #f4f4f2;
				font-family: 'Alfa Slab One';
			}
			header h2 {
				/*color: #f8f980;*/
				color: white;
				font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell, "Helvetica Neue", sans-serif;
				font-variant: small-caps;
				font-size: 2rem;
				font-weight: 300;
			}
			h1 {
				font-family: 'Alfa Slab One';
				font-size: 4.5rem;
				text-align: center;
			}
			#scrolly-overlay .scrolly {
				/*max-width: 60rem;*/
				/*margin: 3rem auto;*/
				background-color: #f4f4f4;
				/*padding: 1rem;*/
			}
			#scrolly-overlay .scrolly article {
				padding: 0;
				margin: 0 auto;
				position: relative;
			}
			#scrolly-overlay .scrolly article .step {
				min-height: 100vh;
				/*margin-bottom: 1rem;*/
			}
			#scrolly-overlay .scrolly article .step:last-of-type {
				/*margin-bottom: 0;*/
			}
			#scrolly-overlay .scrolly article .step-box {
				background-color: #f4f4f2;
				padding: 3rem;
			}
			#scrolly-overlay .scrolly article .step-box-map {
				background-color: black;
				color: white;
				padding: 3rem;
				margin-left: 3rem;
				margin-bottom: 50vh;
				min-height: 10vh;
			}
			#scrolly-overlay .scrolly article .step-box-map-dark {
				background-color: #f4f4f4;
				color: #2e2e2e;
				padding: 3rem;
				margin-left: 3rem;
				margin-bottom: 50vh;
				min-height: 10vh;
			}
			#scrolly-overlay .scrolly figure.sticky {
				position: -webkit-sticky;
				position: sticky;
				width: 100%;
				height: 50vh;
				background: #969696;
				margin: 0;
				top: 25vh;
				left: 0;
			}
			.tick, .tooltip {
				font-family: 'Newsreader', serif;
			}
			.tick {
				font-size: 0.8rem;
			}
			.tooltip {
				font-size: 1.2rem;
			}

			#mapMenu {
				background: #fff;
				position: absolute;
				z-index: 1;
				top: 55px;
				right: 50px;
				border-radius: 4px;
				width: 120px;
				border: 1px solid rgba(0, 0, 0, 0.4);
				font-family: 'Open Sans', sans-serif;
			}
			#mapMenu a {
				font-size: 13px;
				color: #333;
				display: block;
				margin: 0;
				padding: 0;
				padding: 10px;
				text-decoration: none;
				border-bottom: 1px solid rgba(0, 0, 0, 0.25);
				text-align: center;
			}
			#mapMenu a:last-child {
				border: none;
			}
			#mapMenu a:hover {
				background-color: #f8f8f8;
				color: #404040;
				cursor: pointer;
			}
			#mapMenu a.active {
				background-color: #333;
				color: #ffffff;
			}
			#mapVoronoiMenu {
				background: #fff;
				position: absolute;
				z-index: 1;
				top: 55px;
				right: 50px;
				border-radius: 4px;
				width: 120px;
				border: 1px solid rgba(0, 0, 0, 0.4);
				font-family: 'Open Sans', sans-serif;
			}
			#mapVoronoiMenu a {
				font-size: 13px;
				color: #333;
				display: block;
				margin: 0;
				padding: 0;
				padding: 10px;
				text-decoration: none;
				border-bottom: 1px solid rgba(0, 0, 0, 0.25);
				text-align: center;
			}
			#mapVoronoiMenu a:last-child {
				border: none;
			}
			#mapVoronoiMenu a:hover {
				background-color: #f8f8f8;
				color: #404040;
				cursor: pointer;
			}
			#mapVoronoiMenu a.active {
				background-color: #333;
				color: #ffffff;
			}
			#mapPopDotMenu {
				background: #fff;
				position: absolute;
				z-index: 1;
				top: 55px;
				right: 50px;
				border-radius: 4px;
				width: 120px;
				border: 1px solid rgba(0, 0, 0, 0.4);
				font-family: 'Open Sans', sans-serif;
			}
			#mapPopDotMenu a {
				font-size: 13px;
				color: #333;
				display: block;
				margin: 0;
				padding: 0;
				padding: 10px;
				text-decoration: none;
				border-bottom: 1px solid rgba(0, 0, 0, 0.25);
				text-align: center;
			}
			#mapPopDotMenu a:last-child {
				border: none;
			}
			#mapPopDotMenu a:hover {
				background-color: #f8f8f8;
				color: #404040;
				cursor: pointer;
			}
			#mapPopDotMenu a.active {
				background-color: #333;
				color: #ffffff;
			}
        </style>
		<link rel="preconnect" href="https://fonts.gstatic.com">
		<link href="https://fonts.googleapis.com/css2?family=Alfa+Slab+One&display=swap" rel="stylesheet">
		<link href="https://fonts.googleapis.com/css2?family=Newsreader:ital,wght@0,300;0,500;1,300;1,500&display=swap" rel="stylesheet"> 
		<script src="https://d3js.org/d3.v4.min.js"></script>
		<script src="https://unpkg.com/enter-view@1.0.0/enter-view.min.js"></script>
		<script src="https://unpkg.com/stickyfilljs@2.0.5/dist/stickyfill.js"></script>
		<link href="https://api.mapbox.com/mapbox-gl-js/v2.1.1/mapbox-gl.css" rel="stylesheet">
		<script src="https://api.mapbox.com/mapbox-gl-js/v2.1.1/mapbox-gl.js"></script>
		<script src="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.5.1/mapbox-gl-geocoder.min.js"></script>
		<link rel="stylesheet" href="https://api.mapbox.com/mapbox-gl-js/plugins/mapbox-gl-geocoder/v4.5.1/mapbox-gl-geocoder.css" type="text/css">
		<!-- Promise polyfill script required to use Mapbox GL Geocoder in IE 11 -->
		<script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/es6-promise@4/dist/es6-promise.auto.min.js"></script>
	</head>
	<body>

		<div id="header-hero">
			<header>
				<h1>Seroprevalence in Nigeria</h1>
				<h2>Data Visualization by Dave McLaughlin</h2>
			</header>
		</div>
		
		<section id="scrolly-overlay">
		
			<div class="scrolly">
				<!--  sticky graphic   -->
				<figure class="sticky step" data-index='1000' style="height: 100vh; top: 0;">
					<video id="lagos-drone" playsinline muted loop style="object-fit: cover; height: 100vh; width: 100%;">
						<source src="lagos-drone.mp4" type="video/mp4">
					</video>
				</figure>

				<!--  step text   -->
				<article style="max-width: 67vw;">
					<div class='step' data-index='0'>
						<h1 style="color: #f8f980; font-size: 6rem;">Background</h1>
						<div class="step-box" style="display: flex; flex-direction: row;">
							<div style="width: 67%; padding-right: 6rem;">
								<p>Less than a year into a pandemic, scientists are learning more about the disease in Nigeria. Testing individuals for the presence of antibodies builds a picture of the spread of the disease in the country.</p>
								<p>Using test results data, which includes the age and location of the individuals tested, can help inform public policy decisions to more accurately target vaccination campaign rollouts.</p>
								<hr style="border-top: 1px;">
								<p><small><strong>se·​ro·​prev·​a·​lence</strong> <em>/ˌsir-ō-ˈpre-və-lən(t)s</em>: the frequency of individuals in a population that have a particular element (such as antibodies to HIV) in their blood serum</small></p>
							</div>
							<div style="width: 33%;">
								<p><img src="pcr-test.jpg" style="width: 100%;"></p>
							</div>
						</div>
					</div>
				</article>
					
			</div>

			<div class="scrolly">
				<figure class="sticky" style="height: 50vh; top: 0; background-color: #f4f4f2;">
				</figure>

				<article style="max-width: 67vw;">
					<div class="step" data-index="1001" style="min-height: 67vh;">
						<div class="step-box" style="text-align: center;">
							<p>To date, <strong>31,425 individuals</strong> have been tested for the presence of antibodies.</p>
							<p>19,881 tested positive, for a nation-wide rate of <strong>seroprevalence of 63%</strong>.</p>
						</div>
						<div class="step-box" style="text-align: center;">
							<p>Extrapolated to Nigeria&rsquo;s population of <strong>206,630,269</strong>,</p>
							<p><strong>130,724,433</strong> individuals have antibodies to the disease,</p>
							<p>while there are <strong>75,905,836</strong> individuals who do not.</p>
						</div>
					</div>
					<div class='step' data-index='1'>
						<h1>Seroprevalence by Age</h1>

						<div class="step-box" style="display: flex; flex-direction: row;">
							<div style="width: 60%;">
								<div id="seroByAgeChart"></div>
								<script>
									var seroByAgeChartLoaded = 0;
								</script>
							</div>
							<div style="width: 40%;">
								<p>We&rsquo;ve found that seroprevalence varies widely within the population by age.</p>
								<p>Individuals in their late 30&rsquo;s have rates approaching 90%, while &lt;30% of those age 25&ndash;27 have antibodies.</p>
							</div>
						</div>
					</div>
					<div class='step' data-index='2' style="min-height: 67vh;">
						<div class="step-box" style="text-align: center;">
							<p>The test results have been collected from <strong>3,343 locations</strong>.</p>
						</div>
					</div>
				</article>
			</div>

			<div class="scrolly">
				
				<figure class="sticky" style="height: 100vh; top: 0;">
					<nav id="mapMenu">
						<a class="active" id="navClustersAll">All Ages</a>
						<a class="" id="navClusters25">25&ndash;29 Years</a>
						<a class="" id="navClusters30">30&ndash;34 Years</a>
						<a class="" id="navClusters35">35&ndash;39 Years</a>
					</nav>
					<div id="map" style="position: absolute; width: 100%; top: 0; bottom: 0;"></div>
					
					<script>
						mapboxgl.accessToken = 'pk.eyJ1IjoiZGF2ZW1jbGF1Z2hsaW4iLCJhIjoiY2p4bzBlaGJ5MDF3NzNscXA5MnJyeW4xcyJ9.RlsTLBiHzI-gxBHMKZvWCg';
						var map = new mapboxgl.Map({
							container: 'map',
							style: 'mapbox://styles/mapbox/light-v10',
							center: [8, 9],
							zoom: 6
						});
					
						var coordinatesGeocoder = function (query) {
							// match anything which looks like a decimal degrees coordinate pair
							var matches = query.match(
								/^[ ]*(?:Lat: )?(-?\d+\.?\d*)[, ]+(?:Lng: )?(-?\d+\.?\d*)[ ]*$/i
							);
							if (!matches) {
								return null;
							}
							
							function coordinateFeature(lng, lat) {
								return {
									center: [lng, lat],
									geometry: {
										type: 'Point',
										coordinates: [lng, lat]
									},
									place_name: 'Lat: ' + lat + ' Lng: ' + lng,
									place_type: ['coordinate'],
									properties: {},
									type: 'Feature'
								};
							}
							
							var coord1 = Number(matches[1]);
							var coord2 = Number(matches[2]);
							var geocodes = [];
							
							if (coord1 < -90 || coord1 > 90) {
								// must be lng, lat
								geocodes.push(coordinateFeature(coord1, coord2));
							}
							
							if (coord2 < -90 || coord2 > 90) {
								// must be lat, lng
								geocodes.push(coordinateFeature(coord2, coord1));
							}
							
							if (geocodes.length === 0) {
								// else could be either lng, lat or lat, lng
								geocodes.push(coordinateFeature(coord1, coord2));
								geocodes.push(coordinateFeature(coord2, coord1));
							}
							
							return geocodes;
						};
					
						map.addControl(
							new MapboxGeocoder({
								accessToken: mapboxgl.accessToken,
								localGeocoder: coordinatesGeocoder,
								countries: 'ng',
								mapboxgl: mapboxgl
							})
						);
						map.addControl(new mapboxgl.NavigationControl());
					
						map.on('load', function () {
							// Find the index of the first symbol layer in the map style
							// so that the labels can be added over the point clusters
							var layers = map.getStyle().layers;
							var firstSymbolId;
							for (var i = 0; i < layers.length; i++) {
								if (layers[i].type === 'symbol') {
									firstSymbolId = layers[i].id;
									break;
								}
							}

							map.addSource('mapbox-dem', {
								'type': 'raster-dem',
								'url': 'mapbox://mapbox.mapbox-terrain-dem-v1',
								'tileSize': 512,
								'maxzoom': 14
							});
							map.setTerrain({ 'source': 'mapbox-dem', 'exaggeration': 5 });

							map.addSource('clusters', {
								type: 'geojson',
								data: 'clustersData.geojson',
								cluster: true,
								clusterMaxZoom: 22, // Max zoom to cluster points on
								clusterRadius: 1, // Radius of each cluster when clustering points (defaults to 50)
								clusterProperties: {
									sumSero: ["+", ["number", ["get", "sero"], 0]]
								}
							});
							map.addSource('clusters25', {
								type: 'geojson',
								data: 'clustersData25.geojson',
								cluster: true,
								clusterMaxZoom: 22, // Max zoom to cluster points on
								clusterRadius: 1, // Radius of each cluster when clustering points (defaults to 50)
								clusterProperties: {
									sumSero: ["+", ["number", ["get", "sero"], 0]]
								}
							});
							map.addSource('clusters30', {
								type: 'geojson',
								data: 'clustersData30.geojson',
								cluster: true,
								clusterMaxZoom: 22, // Max zoom to cluster points on
								clusterRadius: 1, // Radius of each cluster when clustering points (defaults to 50)
								clusterProperties: {
									sumSero: ["+", ["number", ["get", "sero"], 0]]
								}
							});
							map.addSource('clusters35', {
								type: 'geojson',
								data: 'clustersData35.geojson',
								cluster: true,
								clusterMaxZoom: 22, // Max zoom to cluster points on
								clusterRadius: 1, // Radius of each cluster when clustering points (defaults to 50)
								clusterProperties: {
									sumSero: ["+", ["number", ["get", "sero"], 0]]
								}
							});

							map.addLayer(
								{
									id: 'clusters',
									type: 'circle',
									source: 'clusters',
									filter: ['has', 'point_count'],
									paint: {
										'circle-radius': ['interpolate', ['linear'], ['get', 'point_count'],
											2, 6,
											100, 50
										],
										'circle-color': ['interpolate', ['linear'], ['/', ['get', 'sumSero'], ['get', 'point_count']],
											0, '#2c7fb8',
											1, '#f8f980'
										],
										'circle-opacity': ['interpolate', ['linear'], ['/', ['get', 'sumSero'], ['get', 'point_count']],
											0, 0.1,
											1, 0.8
										]
									}
								},
								firstSymbolId
							);
							map.addLayer({
								id: 'unclustered-point',
								type: 'circle',
								source: 'clusters',
								filter: ['!', ['has', 'point_count']],
								paint: {
									'circle-radius': 3,
									'circle-color': ['interpolate', ['linear'], ['/', ['get', 'sero', ['properties']], 1],
										0, '#2c7fb8',
										1, '#f8f980'
									],
									'circle-opacity': ['interpolate', ['linear'], ['/', ['get', 'sero', ['properties']], 1],
										0, 0.1,
										1, 0.8
									]
								},
								firstSymbolId
							});
							map.addLayer(
								{
									id: 'clusters25',
									type: 'circle',
									source: 'clusters25',
									filter: ['has', 'point_count'],
									layout: {
										'visibility': 'none'
									},
									paint: {
										'circle-radius': ['interpolate', ['linear'], ['get', 'point_count'],
											2, 6,
											100, 50
										],
										'circle-color': ['interpolate', ['linear'], ['/', ['get', 'sumSero'], ['get', 'point_count']],
											0, '#2c7fb8',
											1, '#f8f980'
										],
										'circle-opacity': ['interpolate', ['linear'], ['/', ['get', 'sumSero'], ['get', 'point_count']],
											0, 0.1,
											1, 0.8
										]
									}
								},
								firstSymbolId
							);
							map.addLayer({
								id: 'unclustered-point25',
								type: 'circle',
								source: 'clusters25',
								filter: ['!', ['has', 'point_count']],
								layout: {
									'visibility': 'none'
								},
								paint: {
									'circle-radius': 3,
									'circle-color': ['interpolate', ['linear'], ['/', ['get', 'sero', ['properties']], 1],
										0, '#2c7fb8',
										1, '#f8f980'
									],
									'circle-opacity': ['interpolate', ['linear'], ['/', ['get', 'sero', ['properties']], 1],
										0, 0.1,
										1, 0.8
									]
								},
								firstSymbolId
							});
							map.addLayer(
								{
									id: 'clusters30',
									type: 'circle',
									source: 'clusters30',
									filter: ['has', 'point_count'],
									layout: {
										'visibility': 'none'
									},
									paint: {
										'circle-radius': ['interpolate', ['linear'], ['get', 'point_count'],
											2, 6,
											100, 50
										],
										'circle-color': ['interpolate', ['linear'], ['/', ['get', 'sumSero'], ['get', 'point_count']],
											0, '#2c7fb8',
											1, '#f8f980'
										],
										'circle-opacity': ['interpolate', ['linear'], ['/', ['get', 'sumSero'], ['get', 'point_count']],
											0, 0.1,
											1, 0.8
										]
									}
								},
								firstSymbolId
							);
							map.addLayer({
								id: 'unclustered-point30',
								type: 'circle',
								source: 'clusters30',
								filter: ['!', ['has', 'point_count']],
								layout: {
									'visibility': 'none'
								},
								paint: {
									'circle-radius': 3,
									'circle-color': ['interpolate', ['linear'], ['/', ['get', 'sero', ['properties']], 1],
										0, '#2c7fb8',
										1, '#f8f980'
									],
									'circle-opacity': ['interpolate', ['linear'], ['/', ['get', 'sero', ['properties']], 1],
										0, 0.1,
										1, 0.8
									]
								},
								firstSymbolId
							});
							map.addLayer(
								{
									id: 'clusters35',
									type: 'circle',
									source: 'clusters35',
									filter: ['has', 'point_count'],
									layout: {
										'visibility': 'none'
									},
									paint: {
										'circle-radius': ['interpolate', ['linear'], ['get', 'point_count'],
											2, 6,
											100, 50
										],
										'circle-color': ['interpolate', ['linear'], ['/', ['get', 'sumSero'], ['get', 'point_count']],
											0, '#2c7fb8',
											1, '#f8f980'
										],
										'circle-opacity': ['interpolate', ['linear'], ['/', ['get', 'sumSero'], ['get', 'point_count']],
											0, 0.1,
											1, 0.8
										]
									}
								},
								firstSymbolId
							);
							map.addLayer({
								id: 'unclustered-point35',
								type: 'circle',
								source: 'clusters35',
								filter: ['!', ['has', 'point_count']],
								layout: {
									'visibility': 'none'
								},
								paint: {
									'circle-radius': 3,
									'circle-color': ['interpolate', ['linear'], ['/', ['get', 'sero', ['properties']], 1],
										0, '#2c7fb8',
										1, '#f8f980'
									],
									'circle-opacity': ['interpolate', ['linear'], ['/', ['get', 'sero', ['properties']], 1],
										0, 0.1,
										1, 0.8
									]
								},
								firstSymbolId
							});
					
							map.on('click', 'clusters', function (e) {
								var features = map.queryRenderedFeatures(e.point, {
									layers: ['clusters']
								});
								var clusterId = features[0].properties.cluster_id;
								new mapboxgl.Popup()
									.setLngLat(features[0].geometry.coordinates)
									.setHTML(
										'<strong>' + features[0].properties.point_count + ' Individuals</strong><br>' +
										'Seroprevalence: ' + (features[0].properties.sumSero / features[0].properties.point_count).toLocaleString("en", {style: "percent"})
									)
									.addTo(map);
							});
							map.on('click', 'unclustered-point', function (e) {
								var coordinates = e.features[0].geometry.coordinates.slice();
								var age = e.features[0].properties.age;
								var sero;
								if (e.features[0].properties.sero == 1) {
									sero = 'Yes';
								} else {
									sero = 'No';
								}
								new mapboxgl.Popup()
									.setLngLat(coordinates)
									.setHTML(
										'<strong>Single Individual</strong><br>' +
										'Age: ' + age + '<br>' +
										'Seroprevalence: ' + sero
									)
									.addTo(map);
							});
							map.on('click', 'clusters25', function (e) {
								var features = map.queryRenderedFeatures(e.point, {
									layers: ['clusters25']
								});
								var clusterId = features[0].properties.cluster_id;
								new mapboxgl.Popup()
									.setLngLat(features[0].geometry.coordinates)
									.setHTML(
										'<strong>' + features[0].properties.point_count + ' Individuals</strong><br>' +
										'Seroprevalence: ' + (features[0].properties.sumSero / features[0].properties.point_count).toLocaleString("en", {style: "percent"})
									)
									.addTo(map);
							});
							map.on('click', 'unclustered-point25', function (e) {
								var coordinates = e.features[0].geometry.coordinates.slice();
								var age = e.features[0].properties.age;
								var sero;
								if (e.features[0].properties.sero == 1) {
									sero = 'Yes';
								} else {
									sero = 'No';
								}
								new mapboxgl.Popup()
									.setLngLat(coordinates)
									.setHTML(
										'<strong>Single Individual</strong><br>' +
										'Age: ' + age + '<br>' +
										'Seroprevalence: ' + sero
									)
									.addTo(map);
							});
							map.on('click', 'clusters30', function (e) {
								var features = map.queryRenderedFeatures(e.point, {
									layers: ['clusters30']
								});
								var clusterId = features[0].properties.cluster_id;
								new mapboxgl.Popup()
									.setLngLat(features[0].geometry.coordinates)
									.setHTML(
										'<strong>' + features[0].properties.point_count + ' Individuals</strong><br>' +
										'Seroprevalence: ' + (features[0].properties.sumSero / features[0].properties.point_count).toLocaleString("en", {style: "percent"})
									)
									.addTo(map);
							});
							map.on('click', 'unclustered-point30', function (e) {
								var coordinates = e.features[0].geometry.coordinates.slice();
								var age = e.features[0].properties.age;
								var sero;
								if (e.features[0].properties.sero == 1) {
									sero = 'Yes';
								} else {
									sero = 'No';
								}
								new mapboxgl.Popup()
									.setLngLat(coordinates)
									.setHTML(
										'<strong>Single Individual</strong><br>' +
										'Age: ' + age + '<br>' +
										'Seroprevalence: ' + sero
									)
									.addTo(map);
							});
							map.on('click', 'clusters35', function (e) {
								var features = map.queryRenderedFeatures(e.point, {
									layers: ['clusters35']
								});
								var clusterId = features[0].properties.cluster_id;
								new mapboxgl.Popup()
									.setLngLat(features[0].geometry.coordinates)
									.setHTML(
										'<strong>' + features[0].properties.point_count + ' Individuals</strong><br>' +
										'Seroprevalence: ' + (features[0].properties.sumSero / features[0].properties.point_count).toLocaleString("en", {style: "percent"})
									)
									.addTo(map);
							});
							map.on('click', 'unclustered-point35', function (e) {
								var coordinates = e.features[0].geometry.coordinates.slice();
								var age = e.features[0].properties.age;
								var sero;
								if (e.features[0].properties.sero == 1) {
									sero = 'Yes';
								} else {
									sero = 'No';
								}
								new mapboxgl.Popup()
									.setLngLat(coordinates)
									.setHTML(
										'<strong>Single Individual</strong><br>' +
										'Age: ' + age + '<br>' +
										'Seroprevalence: ' + sero
									)
									.addTo(map);
							});
					
							map.on('mouseenter', 'clusters', function () {
								map.getCanvas().style.cursor = 'pointer';
							});
							map.on('mouseenter', 'unclustered-point', function () {
								map.getCanvas().style.cursor = 'pointer';
							});
							map.on('mouseleave', 'clusters', function () {
								map.getCanvas().style.cursor = '';
							});
							map.on('mouseleave', 'unclustered-point', function () {
								map.getCanvas().style.cursor = '';
							});
							map.on('mouseenter', 'clusters25', function () {
								map.getCanvas().style.cursor = 'pointer';
							});
							map.on('mouseenter', 'unclustered-point25', function () {
								map.getCanvas().style.cursor = 'pointer';
							});
							map.on('mouseleave', 'clusters25', function () {
								map.getCanvas().style.cursor = '';
							});
							map.on('mouseleave', 'unclustered-point25', function () {
								map.getCanvas().style.cursor = '';
							});
							map.on('mouseenter', 'clusters30', function () {
								map.getCanvas().style.cursor = 'pointer';
							});
							map.on('mouseenter', 'unclustered-point30', function () {
								map.getCanvas().style.cursor = 'pointer';
							});
							map.on('mouseleave', 'clusters30', function () {
								map.getCanvas().style.cursor = '';
							});
							map.on('mouseleave', 'unclustered-point30', function () {
								map.getCanvas().style.cursor = '';
							});
							map.on('mouseenter', 'clusters35', function () {
								map.getCanvas().style.cursor = 'pointer';
							});
							map.on('mouseenter', 'unclustered-point35', function () {
								map.getCanvas().style.cursor = 'pointer';
							});
							map.on('mouseleave', 'clusters35', function () {
								map.getCanvas().style.cursor = '';
							});
							map.on('mouseleave', 'unclustered-point35', function () {
								map.getCanvas().style.cursor = '';
							});

							map.scrollZoom.disable();

						});

						document.getElementById('navClustersAll').onclick = function() {
							map.setLayoutProperty('clusters', 'visibility', 'visible');
							map.setLayoutProperty('unclustered-point', 'visibility', 'visible');
							map.setLayoutProperty('clusters25', 'visibility', 'none');
							map.setLayoutProperty('unclustered-point25', 'visibility', 'none');
							map.setLayoutProperty('clusters30', 'visibility', 'none');
							map.setLayoutProperty('unclustered-point30', 'visibility', 'none');
							map.setLayoutProperty('clusters35', 'visibility', 'none');
							map.setLayoutProperty('unclustered-point35', 'visibility', 'none');
							document.getElementById('navClustersAll').className = 'active';
							document.getElementById('navClusters25').className = '';
							document.getElementById('navClusters30').className = '';
							document.getElementById('navClusters35').className = '';
							document.getElementById('navClustersAll').preventDefault();
							document.getElementById('navClustersAll').stopPropagation();
						}
						document.getElementById('navClusters25').onclick = function() {
							map.setLayoutProperty('clusters', 'visibility', 'none');
							map.setLayoutProperty('unclustered-point', 'visibility', 'none');
							map.setLayoutProperty('clusters25', 'visibility', 'visible');
							map.setLayoutProperty('unclustered-point25', 'visibility', 'visible');
							map.setLayoutProperty('clusters30', 'visibility', 'none');
							map.setLayoutProperty('unclustered-point30', 'visibility', 'none');
							map.setLayoutProperty('clusters35', 'visibility', 'none');
							map.setLayoutProperty('unclustered-point35', 'visibility', 'none');
							document.getElementById('navClustersAll').className = '';
							document.getElementById('navClusters25').className = 'active';
							document.getElementById('navClusters30').className = '';
							document.getElementById('navClusters35').className = '';
							document.getElementById('navClusters25').preventDefault();
							document.getElementById('navClusters25').stopPropagation();
						}
						document.getElementById('navClusters30').onclick = function() {
							map.setLayoutProperty('clusters', 'visibility', 'none');
							map.setLayoutProperty('unclustered-point', 'visibility', 'none');
							map.setLayoutProperty('clusters25', 'visibility', 'none');
							map.setLayoutProperty('unclustered-point25', 'visibility', 'none');
							map.setLayoutProperty('clusters30', 'visibility', 'visible');
							map.setLayoutProperty('unclustered-point30', 'visibility', 'visible');
							map.setLayoutProperty('clusters35', 'visibility', 'none');
							map.setLayoutProperty('unclustered-point35', 'visibility', 'none');
							document.getElementById('navClustersAll').className = '';
							document.getElementById('navClusters25').className = '';
							document.getElementById('navClusters30').className = 'active';
							document.getElementById('navClusters35').className = '';
							document.getElementById('navClusters30').preventDefault();
							document.getElementById('navClusters30').stopPropagation();
						}
						document.getElementById('navClusters35').onclick = function() {
							map.setLayoutProperty('clusters', 'visibility', 'none');
							map.setLayoutProperty('unclustered-point', 'visibility', 'none');
							map.setLayoutProperty('clusters25', 'visibility', 'none');
							map.setLayoutProperty('unclustered-point25', 'visibility', 'none');
							map.setLayoutProperty('clusters30', 'visibility', 'none');
							map.setLayoutProperty('unclustered-point30', 'visibility', 'none');
							map.setLayoutProperty('clusters35', 'visibility', 'visible');
							map.setLayoutProperty('unclustered-point35', 'visibility', 'visible');
							document.getElementById('navClustersAll').className = '';
							document.getElementById('navClusters25').className = '';
							document.getElementById('navClusters30').className = '';
							document.getElementById('navClusters35').className = 'active';
							document.getElementById('navClusters35').preventDefault();
							document.getElementById('navClusters35').stopPropagation();
						}
					</script>
				</figure>


				<!--  step text   -->
				<article style="width: 67vw;">
					<div class='step' data-index='3' style="min-height: 67vh;">
						<h1 style="-webkit-text-stroke: 1px #f4f4f2;">Cluster Locations</h1>
					</div>
				</article>
				<article style="max-width: 25vw; margin: 0 auto 0 0;">
					<div class="step step-box-map" data-index="4" style="padding-top: 4rem;">
						<p>Size of circle represents<br># of tests</p>
						<p>Yellow = High Rate<br>
							Blue = Low Rate</p>
						<p>Filter by age</p>
						<p>Click for cluster data</p>
					</div>
					<div class="step step-box-map" data-index="5">
						<p><img src="lagos-skyline.jpg" style="width: 100%;"><br>
							Lagos
						</p>
					</div>
					<div class="step step-box-map" data-index="6">
						<p><img src="sokoto.jpg" style="width: 100%;"><br>
							Rural northwest</p>
					</div>
					<div class="step step-box-map" data-index="7">
						<p><img src="cross-river.jpg" style="width: 100%;"><br>
							Hills in the east</p>
					</div>
					<div class="step step-box-map" data-index="8" style="margin-bottom: 20vh;">
						<p><img src="enugu.jpg" style="width: 100%;"><br>
							Mid-size cities like Enugu</p>
					</div>
				</article>
				<article style="height: 100vh; width: 0;">
					<div class="step" data-index="9"></div>
				</article>
				
			</div>
		
			<div class="scrolly">
				<figure class="sticky" style="height: 33vh; top: 0; background-color: #f4f4f2;">
				</figure>

				<article style="max-width: 67vw;">
					<div class='step' data-index='10' style="min-height: 67vh;">
						<div class="step-box" style="text-align: center;">
							<p>Exploring the existing cluster data is fun, but what if we want to predict results at any given location?</p>
							<p style="margin-top: 4rem;">What if that location doesn&rsquo;t fall on one of our cluster points?</p>
						</div>
					</div>
					<div class="step" data-index="11">
						<h1>Predicting Antibody Status in Individuals</h1>
						<div class="step-box" style="display: flex; flex-direction: row;">
							<div style="width: 40%; padding-right: 6rem; padding-top: 4rem;">
								<p>Using a <strong>Voronoi diagram</strong>, we create polygons of area closest to each cluster point.</p>
								<p>Now it is possible to quickly reference any location against data from the nearest cluster.</p>
								<p>Search the next map by location, then click for local stats.</p>
							</div>
							<div style="width: 60%;">
								<p><img src="voronoi-illustration.gif" style="width: 100%;"></p>
							</div>
						</div>
					</div>
				</article>
			</div>

			<div class="scrolly">
				
				<figure class="sticky" style="height: 100vh; top: 0;">
					<nav id="mapVoronoiMenu">
						<a class="active" id="navVoronoiAll">All Ages</a>
						<a class="" id="navVoronoi25">25&ndash;29 Years</a>
						<a class="" id="navVoronoi30">30&ndash;34 Years</a>
						<a class="" id="navVoronoi35">35&ndash;39 Years</a>
					</nav>
					<div id="mapVoronoi" style="position: absolute; width: 100%; top: 0; bottom: 0;"></div>

					<script>
						mapboxgl.accessToken = 'pk.eyJ1IjoiZGF2ZW1jbGF1Z2hsaW4iLCJhIjoiY2p4bzBlaGJ5MDF3NzNscXA5MnJyeW4xcyJ9.RlsTLBiHzI-gxBHMKZvWCg';
						var mapVoronoi = new mapboxgl.Map({
							container: 'mapVoronoi',
							style: 'mapbox://styles/mapbox/light-v10',
							center: [8, 9],
							zoom: 6
						});
					
						var coordinatesGeocoder = function (query) {
							// match anything which looks like a decimal degrees coordinate pair
							var matches = query.match(
								/^[ ]*(?:Lat: )?(-?\d+\.?\d*)[, ]+(?:Lng: )?(-?\d+\.?\d*)[ ]*$/i
							);
							if (!matches) {
								return null;
							}
							
							function coordinateFeature(lng, lat) {
								return {
									center: [lng, lat],
									geometry: {
										type: 'Point',
										coordinates: [lng, lat]
									},
									place_name: 'Lat: ' + lat + ' Lng: ' + lng,
									place_type: ['coordinate'],
									properties: {},
									type: 'Feature'
								};
							}
							
							var coord1 = Number(matches[1]);
							var coord2 = Number(matches[2]);
							var geocodes = [];
							
							if (coord1 < -90 || coord1 > 90) {
								// must be lng, lat
								geocodes.push(coordinateFeature(coord1, coord2));
							}
							
							if (coord2 < -90 || coord2 > 90) {
								// must be lat, lng
								geocodes.push(coordinateFeature(coord2, coord1));
							}
							
							if (geocodes.length === 0) {
								// else could be either lng, lat or lat, lng
								geocodes.push(coordinateFeature(coord1, coord2));
								geocodes.push(coordinateFeature(coord2, coord1));
							}
							
							return geocodes;
						};
					
						mapVoronoi.addControl(
							new MapboxGeocoder({
								accessToken: mapboxgl.accessToken,
								localGeocoder: coordinatesGeocoder,
								countries: 'ng',
								mapboxgl: mapboxgl
							})
						);
						mapVoronoi.addControl(new mapboxgl.NavigationControl());
					
						mapVoronoi.on('load', function () {
							var layers = mapVoronoi.getStyle().layers;
							var firstSymbolId;
							for (var i = 0; i < layers.length; i++) {
								if (layers[i].type === 'symbol') {
									firstSymbolId = layers[i].id;
									break;
								}
							}
					
							mapVoronoi.addSource('voronoiStatsTotal', {
								type: 'vector',
								url: 'mapbox://davemclaughlin.cklljqxhv0bxb21nqurwzll79-86him'
							});
							mapVoronoi.addSource('voronoiStats25-29', {
								type: 'vector',
								url: 'mapbox://davemclaughlin.ckllk7uw2054z28qv7m18fq5n-42br4'
							});
					
							mapVoronoi.addSource('voronoiStats30-34', {
								type: 'vector',
								url: 'mapbox://davemclaughlin.ckllk9sf9055r28qvh0xds9wg-9ta5n'
							});
					
							mapVoronoi.addSource('voronoiStats35-39', {
								type: 'vector',
								url: 'mapbox://davemclaughlin.ckllkax310qzj20p5d8tyqbfz-58w5a'
							});

							mapVoronoi.addLayer(
								{
									id: 'voronoiStatsTotal',
									type: 'fill',
									source: 'voronoiStatsTotal',
									'source-layer': 'voronoi-stats-total',
									paint: {
										'fill-color': ['interpolate', ['linear'], ['/', ['get', 'sero'], ['get', 'count']],
											0, '#2c7fb8',
											1, '#f8f980'
										],
										'fill-opacity': ['interpolate', ['linear'], ['get', 'count'],
											1, 0.1,
											40, 0.95
										]
									}
								},
								firstSymbolId
							);
							mapVoronoi.addLayer(
								{
									id: 'voronoiStats25',
									type: 'fill',
									source: 'voronoiStats25-29',
									'source-layer': 'voronoi-stats-25-29',
									layout: {
										'visibility': 'none'
									},
									paint: {
										'fill-color': ['interpolate', ['linear'], ['/', ['get', 'sero'], ['get', 'count']],
											0, '#2c7fb8',
											1, '#f8f980'
										],
										'fill-opacity': ['interpolate', ['linear'], ['get', 'count'],
											1, 0.1,
											40, 0.95
										]
									}
								},
								firstSymbolId
							);
							mapVoronoi.addLayer(
								{
									id: 'voronoiStats30',
									type: 'fill',
									source: 'voronoiStats30-34',
									'source-layer': 'voronoi-stats-30-34',
									layout: {
										'visibility': 'none'
									},
									paint: {
										'fill-color': ['interpolate', ['linear'], ['/', ['get', 'sero'], ['get', 'count']],
											0, '#2c7fb8',
											1, '#f8f980'
										],
										'fill-opacity': ['interpolate', ['linear'], ['get', 'count'],
											1, 0.1,
											40, 0.95
										]
									}
								},
								firstSymbolId
							);
							mapVoronoi.addLayer(
								{
									id: 'voronoiStats35',
									type: 'fill',
									source: 'voronoiStats35-39',
									'source-layer': 'voronoi-stats-35-39',
									layout: {
										'visibility': 'none'
									},
									paint: {
										'fill-color': ['interpolate', ['linear'], ['/', ['get', 'sero'], ['get', 'count']],
											0, '#2c7fb8',
											1, '#f8f980'
										],
										'fill-opacity': ['interpolate', ['linear'], ['get', 'count'],
											1, 0.1,
											40, 0.95
										]
									}
								},
								firstSymbolId
							);

							mapVoronoi.on('click', 'voronoiStatsTotal', function (e) {
								if (e.features[0].properties.count == 1) {
									var msgHeader = '<strong>1 Individual</strong><br>';
								} else {
									var msgHeader = '<strong>' + e.features[0].properties.count + ' Individuals</strong><br>';
								}
								new mapboxgl.Popup()
									.setLngLat(e.lngLat)
									.setHTML(
										msgHeader +
										'Seroprevalence: ' + (e.features[0].properties.sero / e.features[0].properties.count).toLocaleString("en", {style: "percent"})
									)
									.addTo(mapVoronoi);
							});
							mapVoronoi.on('mouseenter', 'voronoiStatsTotal', function () {
								mapVoronoi.getCanvas().style.cursor = 'pointer';
							});
							mapVoronoi.on('mouseleave', 'voronoiStatsTotal', function () {
								mapVoronoi.getCanvas().style.cursor = '';
							});
							mapVoronoi.on('click', 'voronoiStats25', function (e) {
								if (e.features[0].properties.count == 1) {
									var msgHeader = '<strong>1 Individual</strong><br>';
								} else {
									var msgHeader = '<strong>' + e.features[0].properties.count + ' Individuals</strong><br>';
								}
								new mapboxgl.Popup()
									.setLngLat(e.lngLat)
									.setHTML(
										msgHeader +
										'Seroprevalence: ' + (e.features[0].properties.sero / e.features[0].properties.count).toLocaleString("en", {style: "percent"})
									)
									.addTo(mapVoronoi);
							});
							mapVoronoi.on('mouseenter', 'voronoiStats25', function () {
								mapVoronoi.getCanvas().style.cursor = 'pointer';
							});
							mapVoronoi.on('mouseleave', 'voronoiStats25', function () {
								mapVoronoi.getCanvas().style.cursor = '';
							});
							mapVoronoi.on('click', 'voronoiStats30', function (e) {
								if (e.features[0].properties.count == 1) {
									var msgHeader = '<strong>1 Individual</strong><br>';
								} else {
									var msgHeader = '<strong>' + e.features[0].properties.count + ' Individuals</strong><br>';
								}
								new mapboxgl.Popup()
									.setLngLat(e.lngLat)
									.setHTML(
										msgHeader +
										'Seroprevalence: ' + (e.features[0].properties.sero / e.features[0].properties.count).toLocaleString("en", {style: "percent"})
									)
									.addTo(mapVoronoi);
							});
							mapVoronoi.on('mouseenter', 'voronoiStats30', function () {
								mapVoronoi.getCanvas().style.cursor = 'pointer';
							});
							mapVoronoi.on('mouseleave', 'voronoiStats30', function () {
								mapVoronoi.getCanvas().style.cursor = '';
							});
							mapVoronoi.on('click', 'voronoiStats35', function (e) {
								if (e.features[0].properties.count == 1) {
									var msgHeader = '<strong>1 Individual</strong><br>';
								} else {
									var msgHeader = '<strong>' + e.features[0].properties.count + ' Individuals</strong><br>';
								}
								new mapboxgl.Popup()
									.setLngLat(e.lngLat)
									.setHTML(
										msgHeader +
										'Seroprevalence: ' + (e.features[0].properties.sero / e.features[0].properties.count).toLocaleString("en", {style: "percent"})
									)
									.addTo(mapVoronoi);
							});
							mapVoronoi.on('mouseenter', 'voronoiStats35', function () {
								mapVoronoi.getCanvas().style.cursor = 'pointer';
							});
							mapVoronoi.on('mouseleave', 'voronoiStats35', function () {
								mapVoronoi.getCanvas().style.cursor = '';
							});

							mapVoronoi.scrollZoom.disable();
						});

						document.getElementById('navVoronoiAll').onclick = function() {
							mapVoronoi.setLayoutProperty('voronoiStatsTotal', 'visibility', 'visible');
							mapVoronoi.setLayoutProperty('voronoiStats25', 'visibility', 'none');
							mapVoronoi.setLayoutProperty('voronoiStats30', 'visibility', 'none');
							mapVoronoi.setLayoutProperty('voronoiStats35', 'visibility', 'none');
							document.getElementById('navVoronoiAll').className = 'active';
							document.getElementById('navVoronoi25').className = '';
							document.getElementById('navVoronoi30').className = '';
							document.getElementById('navVoronoi35').className = '';
							document.getElementById('navVoronoiAll').preventDefault();
							document.getElementById('navVoronoiAll').stopPropagation();
						}
						document.getElementById('navVoronoi25').onclick = function() {
							mapVoronoi.setLayoutProperty('voronoiStatsTotal', 'visibility', 'none');
							mapVoronoi.setLayoutProperty('voronoiStats25', 'visibility', 'visible');
							mapVoronoi.setLayoutProperty('voronoiStats30', 'visibility', 'none');
							mapVoronoi.setLayoutProperty('voronoiStats35', 'visibility', 'none');
							document.getElementById('navVoronoiAll').className = '';
							document.getElementById('navVoronoi25').className = 'active';
							document.getElementById('navVoronoi30').className = '';
							document.getElementById('navVoronoi35').className = '';
							document.getElementById('navVoronoi25').preventDefault();
							document.getElementById('navVoronoi25').stopPropagation();
						}
						document.getElementById('navVoronoi30').onclick = function() {
							mapVoronoi.setLayoutProperty('voronoiStatsTotal', 'visibility', 'none');
							mapVoronoi.setLayoutProperty('voronoiStats25', 'visibility', 'none');
							mapVoronoi.setLayoutProperty('voronoiStats30', 'visibility', 'visible');
							mapVoronoi.setLayoutProperty('voronoiStats35', 'visibility', 'none');
							document.getElementById('navVoronoiAll').className = '';
							document.getElementById('navVoronoi25').className = '';
							document.getElementById('navVoronoi30').className = 'active';
							document.getElementById('navVoronoi35').className = '';
							document.getElementById('navVoronoi30').preventDefault();
							document.getElementById('navVoronoi30').stopPropagation();
						}
						document.getElementById('navVoronoi35').onclick = function() {
							mapVoronoi.setLayoutProperty('voronoiStatsTotal', 'visibility', 'none');
							mapVoronoi.setLayoutProperty('voronoiStats25', 'visibility', 'none');
							mapVoronoi.setLayoutProperty('voronoiStats30', 'visibility', 'none');
							mapVoronoi.setLayoutProperty('voronoiStats35', 'visibility', 'visible');
							document.getElementById('navVoronoiAll').className = '';
							document.getElementById('navVoronoi25').className = '';
							document.getElementById('navVoronoi30').className = '';
							document.getElementById('navVoronoi35').className = 'active';
							document.getElementById('navVoronoi35').preventDefault();
							document.getElementById('navVoronoi35').stopPropagation();
						}
					</script>
				</figure>
				<article style="height: 50vh; width: 0;">
					<div class="step" data-index="12"></div>
				</article>
			</div>

			<div class="scrolly">
				<figure class="sticky" style="height: 33vh; top: 0; background-color: #f4f4f2;">
				</figure>

				<article style="max-width: 67vw;">
					<div class='step' data-index='13' style="min-height: 100vh;">
						<p style="text-align: center;"><strong>Caution!</strong></p>
						<div class="step-box" style="display: flex; flex-direction: row;">
							<div style="width: 60%; padding-right: 6rem;">
								<img src="election-map.jpg" style="width: 100%;">
							</div>
							<div style="width: 40%;">
								<p>Viewing data as filled polygons on a map can lead to the impression that the phenomenon is distributed evenly throughout the areas.</p>
								<p>Just like land doesn&rsquo;t vote,<br>
									the land doesn&rsquo;t catch this disease<br>
									&mdash; people do.</p>
							</div>
						</div>
						<p style="margin-top: 12rem; text-align: center;">So let&rsquo;s map the people.</p>
					</div>
				</article>
			</div>

			<div class="scrolly">
				<article style="height: 0; width: 0;">
					<div class="step" data-index="14">
					</div>
				</article>
				<figure class="sticky" style="height: 100vh; top: 0;">
					<nav id="mapPopDotMenu">
						<a class="active" id="navPopDotAll">All Ages</a>
						<a class="" id="navPopDot25">25&ndash;29 Years</a>
						<a class="" id="navPopDot30">30&ndash;34 Years</a>
						<a class="" id="navPopDot35">35&ndash;39 Years</a>
					</nav>
					<div id="mapPopDot" style="position: absolute; width: 100%; top: 0; bottom: 0;"></div>
					
					<script>
						mapboxgl.accessToken = 'pk.eyJ1IjoiZGF2ZW1jbGF1Z2hsaW4iLCJhIjoiY2p4bzBlaGJ5MDF3NzNscXA5MnJyeW4xcyJ9.RlsTLBiHzI-gxBHMKZvWCg';
						var mapPopDot = new mapboxgl.Map({
							container: 'mapPopDot',
							style: 'mapbox://styles/mapbox/dark-v10',
							center: { lon: 0, lat: -8 },
							zoom: 3.2,
							pitch: 57,
							bearing: 19
						});
					
						var coordinatesGeocoder = function (query) {
							// match anything which looks like a decimal degrees coordinate pair
							var matches = query.match(
								/^[ ]*(?:Lat: )?(-?\d+\.?\d*)[, ]+(?:Lng: )?(-?\d+\.?\d*)[ ]*$/i
							);
							if (!matches) {
								return null;
							}
							
							function coordinateFeature(lng, lat) {
								return {
									center: [lng, lat],
									geometry: {
										type: 'Point',
										coordinates: [lng, lat]
									},
									place_name: 'Lat: ' + lat + ' Lng: ' + lng,
									place_type: ['coordinate'],
									properties: {},
									type: 'Feature'
								};
							}
							
							var coord1 = Number(matches[1]);
							var coord2 = Number(matches[2]);
							var geocodes = [];
							
							if (coord1 < -90 || coord1 > 90) {
								// must be lng, lat
								geocodes.push(coordinateFeature(coord1, coord2));
							}
							
							if (coord2 < -90 || coord2 > 90) {
								// must be lat, lng
								geocodes.push(coordinateFeature(coord2, coord1));
							}
							
							if (geocodes.length === 0) {
								// else could be either lng, lat or lat, lng
								geocodes.push(coordinateFeature(coord1, coord2));
								geocodes.push(coordinateFeature(coord2, coord1));
							}
							
							return geocodes;
						};
					
						mapPopDot.addControl(
							new MapboxGeocoder({
								accessToken: mapboxgl.accessToken,
								localGeocoder: coordinatesGeocoder,
								countries: 'ng',
								mapboxgl: mapboxgl
							})
						);
						mapPopDot.addControl(new mapboxgl.NavigationControl());
					
						mapPopDot.on('load', function () {
							var layers = mapPopDot.getStyle().layers;
							var firstSymbolId;
							for (var i = 0; i < layers.length; i++) {
								if (layers[i].type === 'symbol') {
									firstSymbolId = layers[i].id;
									break;
								}
							}

							mapPopDot.addSource('popDot', {
								type: 'raster',
								url: 'mapbox://davemclaughlin.839tfkdk'
							});
							mapPopDot.addSource('popDot25', {
								type: 'raster',
								url: 'mapbox://davemclaughlin.5bmujd6n'
							});
							mapPopDot.addSource('popDot30', {
								type: 'raster',
								url: 'mapbox://davemclaughlin.bggi2i25'
							});
							mapPopDot.addSource('popDot35', {
								type: 'raster',
								url: 'mapbox://davemclaughlin.b4duh1ro'
							});
					
							mapPopDot.addLayer( {
									id: "popDot",
									type: "raster",
									source: "popDot"
								},
								firstSymbolId
							);
							mapPopDot.addLayer( {
									id: "popDot25",
									type: "raster",
									source: "popDot25",
									layout: {
										'visibility': 'none'
									}
								},
								firstSymbolId
							);
							mapPopDot.addLayer( {
									id: "popDot30",
									type: "raster",
									source: "popDot30",
									layout: {
										'visibility': 'none'
									}
								},
								firstSymbolId
							);
							mapPopDot.addLayer( {
									id: "popDot35",
									type: "raster",
									source: "popDot35",
									layout: {
										'visibility': 'none'
									}
								},
								firstSymbolId
							);
							
							mapPopDot.scrollZoom.disable();

							document.getElementById('navPopDotAll').onclick = function() {
								mapPopDot.setLayoutProperty('popDot', 'visibility', 'visible');
								mapPopDot.setLayoutProperty('popDot25', 'visibility', 'none');
								mapPopDot.setLayoutProperty('popDot30', 'visibility', 'none');
								mapPopDot.setLayoutProperty('popDot35', 'visibility', 'none');
								document.getElementById('navPopDotAll').className = 'active';
								document.getElementById('navPopDot25').className = '';
								document.getElementById('navPopDot30').className = '';
								document.getElementById('navPopDot35').className = '';
								document.getElementById('navPopDotAll').preventDefault();
								document.getElementById('navPopDotAll').stopPropagation();
							}
							document.getElementById('navPopDot25').onclick = function() {
								mapPopDot.setLayoutProperty('popDot', 'visibility', 'none');
								mapPopDot.setLayoutProperty('popDot25', 'visibility', 'visible');
								mapPopDot.setLayoutProperty('popDot30', 'visibility', 'none');
								mapPopDot.setLayoutProperty('popDot35', 'visibility', 'none');
								document.getElementById('navPopDotAll').className = '';
								document.getElementById('navPopDot25').className = 'active';
								document.getElementById('navPopDot30').className = '';
								document.getElementById('navPopDot35').className = '';
								document.getElementById('navPopDot25').preventDefault();
								document.getElementById('navPopDot25').stopPropagation();
							}
							document.getElementById('navPopDot30').onclick = function() {
								mapPopDot.setLayoutProperty('popDot', 'visibility', 'none');
								mapPopDot.setLayoutProperty('popDot25', 'visibility', 'none');
								mapPopDot.setLayoutProperty('popDot30', 'visibility', 'visible');
								mapPopDot.setLayoutProperty('popDot35', 'visibility', 'none');
								document.getElementById('navPopDotAll').className = '';
								document.getElementById('navPopDot25').className = '';
								document.getElementById('navPopDot30').className = 'active';
								document.getElementById('navPopDot35').className = '';
								document.getElementById('navPopDot30').preventDefault();
								document.getElementById('navPopDot30').stopPropagation();
							}
							document.getElementById('navPopDot35').onclick = function() {
								mapPopDot.setLayoutProperty('popDot', 'visibility', 'none');
								mapPopDot.setLayoutProperty('popDot25', 'visibility', 'none');
								mapPopDot.setLayoutProperty('popDot30', 'visibility', 'none');
								mapPopDot.setLayoutProperty('popDot35', 'visibility', 'visible');
								document.getElementById('navPopDotAll').className = '';
								document.getElementById('navPopDot25').className = '';
								document.getElementById('navPopDot30').className = '';
								document.getElementById('navPopDot35').className = 'active';
								document.getElementById('navPopDot35').preventDefault();
								document.getElementById('navPopDot35').stopPropagation();
							}

						});
					</script>
				</figure>


				<!--  step text   -->
				<article style="width: 67vw;">
					<div class='step' data-index='15' style="min-height: 100vh;">
						<h1 style="color: #f4f4f2;">Population Grid</h1>
					</div>
				</article>
				<article style="max-width: 25vw; margin: 0 auto 0 0;">
					<div class="step step-box-map-dark" data-index="16" style="padding-top: 4rem;">
						<p>Population estimates for each 100m&sup2;</p>
						<p>Brighter points =<br>&nbsp;Higher Pop. Density</p>
						<p>Yellow = High Rate<br>
							Blue = Low Rate</p>
					</div>
					<div class="step step-box-map-dark" data-index="17">
						<p><img src="port-harcourt.jpg" style="width: 100%;"><br>
							Port Harcourt</p>
					</div>
					<div class="step step-box-map-dark" data-index="18">
						<p><img src="yola.jpg" style="width: 100%;"><br>
							Rural northeast</p>
					</div>
				</article>
				<article style="height: 100vh; width: 0;">
					<div class="step" data-index="19"></div>
				</article>
				
			</div>

			<div class="scrolly">
				<figure class="sticky" style="height: 50vh; top: 0; background-color: #f4f4f2;">
				</figure>

				<article style="max-width: 67vw;">
					<div class='step' data-index='20'>
						<h1>Informing Vaccination Campaign Strategy</h1>

						<div class="step-box" style="display: flex; flex-direction: row;">
							<div style="width: 40%;">
								<p>The data point to establishing three priorities for public health officials when targeting vaccination campaigns:</p>
							</div>
							<div style="width: 60%;">
							</div>
						</div>
						<div class="step-box" style="display: flex; flex-direction: row;">
							<div style="width: 60%;">
							</div>
							<div style="width: 40%;">
								<p><strong>1. Areas with low seroprevalence</strong><br>
									Because people move across the landscape and carry the pathogen with them, it is important to prioritize vaccinating those in areas that have not yet had wide exposure.
								</p>
							</div>
						</div>
						<div class="step-box" style="display: flex; flex-direction: row;">
							<div style="width: 50%;">
								<p><strong>2. The young</strong> *<br>
									In general, the younger an individual&rsquo;s age in our test result data, the less likely they were to have antibodies and be protected from the disease.
								</p>
							</div>
							<div style="width: 50%;">
							</div>
						</div>
						<div class="step-box" style="display: flex; flex-direction: row;">
							<div style="width: 60%;">
							</div>
							<div style="width: 40%;">
								<p><strong>3. The elderly</strong> *<br>
									We can assume from the data that the older an individual is, the more susceptible they are to catching the disease. Areas where older individuals still have low rates of antibodies should be given highest priority for vaccination.
								</p>								
							</div>
						</div>
						<div class="step-box" style="display: flex; flex-direction: row;">
							<div style="width: 20%;">
							</div>
							<div style="width: 65%;">
								<p><em>* It is impossible to know from this data alone if:</em></p>
								<ul>
									<li><em>Symptom and outcome severity vary by age</em></li>
									<li><em>Individuals of different ages spread the disease at the same rate</em></li>
								</ul>
							</div>
							<div style="width: 15%;">
							</div>
						</div>
					</div>
					<div class='step' data-index='21' style="padding-top: 33vh; min-height: 67vh;">
						<div class="step-box" style="text-align: center;">
							<p>State and local governments will be instrumental in rolling out the vaccines.</p>
							<p>Given the above priorities, which areas should be early targets for vaccination campaigns?</p>
						</div>
					</div>
				</article>
			</div>

			<div class="scrolly">
				<figure class="sticky" style="height: 100vh; top: 0;">
					<div id="mapAdmin" style="position: absolute; width: 100%; top: 0; bottom: 0;"></div>
					
					<script>
						mapboxgl.accessToken = 'pk.eyJ1IjoiZGF2ZW1jbGF1Z2hsaW4iLCJhIjoiY2p4bzBlaGJ5MDF3NzNscXA5MnJyeW4xcyJ9.RlsTLBiHzI-gxBHMKZvWCg';
						var mapAdmin = new mapboxgl.Map({
							container: 'mapAdmin',
							style: 'mapbox://styles/mapbox/light-v10',
							center: [8, 9],
							zoom: 6
						});
					
						var zoomThreshold = 6.5;
					
						var coordinatesGeocoder = function (query) {
							// match anything which looks like a decimal degrees coordinate pair
							var matches = query.match(
								/^[ ]*(?:Lat: )?(-?\d+\.?\d*)[, ]+(?:Lng: )?(-?\d+\.?\d*)[ ]*$/i
							);
							if (!matches) {
								return null;
							}
							
							function coordinateFeature(lng, lat) {
								return {
									center: [lng, lat],
									geometry: {
										type: 'Point',
										coordinates: [lng, lat]
									},
									place_name: 'Lat: ' + lat + ' Lng: ' + lng,
									place_type: ['coordinate'],
									properties: {},
									type: 'Feature'
								};
							}
							
							var coord1 = Number(matches[1]);
							var coord2 = Number(matches[2]);
							var geocodes = [];
							
							if (coord1 < -90 || coord1 > 90) {
								// must be lng, lat
								geocodes.push(coordinateFeature(coord1, coord2));
							}
							
							if (coord2 < -90 || coord2 > 90) {
								// must be lat, lng
								geocodes.push(coordinateFeature(coord2, coord1));
							}
							
							if (geocodes.length === 0) {
								// else could be either lng, lat or lat, lng
								geocodes.push(coordinateFeature(coord1, coord2));
								geocodes.push(coordinateFeature(coord2, coord1));
							}
							
							return geocodes;
						};
					
						mapAdmin.addControl(
							new MapboxGeocoder({
								accessToken: mapboxgl.accessToken,
								localGeocoder: coordinatesGeocoder,
								countries: 'ng',
								mapboxgl: mapboxgl
							})
						);
						mapAdmin.addControl(new mapboxgl.NavigationControl());
					
						mapAdmin.on('load', function () {
							var layers = mapAdmin.getStyle().layers;
							var firstSymbolId;
							for (var i = 0; i < layers.length; i++) {
								if (layers[i].type === 'symbol') {
									firstSymbolId = layers[i].id;
									break;
								}
							}
					
							mapAdmin.addSource('admin-l2', {
								type: 'vector',
								url: 'mapbox://davemclaughlin.ckllmj5nv01b226nsxwbqubk4-1abs7'
							});

							mapAdmin.addSource('admin-l3', {
								type: 'vector',
								url: 'mapbox://davemclaughlin.ckllmhupe09u820po3g63txgp-11v5s'
							});

							mapAdmin.addLayer(
								{
									id: 'admin-l2',
									type: 'fill',
									source: 'admin-l2',
									'source-layer': 'admin-l2',
									maxzoom: zoomThreshold,
									paint: {
										'fill-color': ['interpolate', ['linear'], ['/', ['get', 'seroTot'], ['get', 'countTot']],
											0, '#2c7fb8',
											1, '#f8f980'
										],
										'fill-opacity': ['step', ['get', 'countTot'],
											0,
											1,
											0.8
										],
										'fill-outline-color': '#eee',
									}
								},
								firstSymbolId
							);

							mapAdmin.addLayer(
								{
									id: 'admin-l3',
									type: 'fill-extrusion',
									source: 'admin-l3',
									'source-layer': 'admin-l3',
									minzoom: zoomThreshold,
									paint: {
										'fill-extrusion-color': ['interpolate', ['linear'], ['/', ['get', 'seroTot'], ['get', 'countTot']],
											0, '#2c7fb8',
											1, '#f8f980'
										],
										'fill-extrusion-height': 0,
										'fill-extrusion-base': 0,
										'fill-extrusion-opacity': 0.8,
									}
								}
							);

							mapAdmin.on('click', 'admin-l2', function (e) {
								var msgHeading =
									'<strong>' + e.features[0].properties.statename + '</strong> <em>' + e.features[0].properties.capcity + '</em><br><br>' +
									'<table><tr><th style="text-align: left;">Total Population</th><td>' + e.features[0].properties.pop.toLocaleString("en") + '</td></tr>';
								var msgSero;
								if (e.features[0].properties.countTot == 0) {
									var msgSero = '<tr><th style="text-align: left;">Without Antibodies</th><td>No data</td></tr></table>';
								} else {
									var msgSero =
										'<tr><th style="text-align: left;">Without Antibodies</th><td>' + Math.round((e.features[0].properties.pop * (e.features[0].properties.seroTot / e.features[0].properties.countTot))).toLocaleString("en") + '</td></tr></table>' +
										'<br><strong>Seroprevalence</strong>' + 
										'<table><tr><th style="text-align: left;">Overall</th><td>' + (e.features[0].properties.seroTot / e.features[0].properties.countTot).toLocaleString("en", {style: "percent"}) + '</td></tr>' +
										'<tr><th style="text-align: left;">25&ndash;29</th><td>' + (e.features[0].properties.sero25 / e.features[0].properties.count25).toLocaleString("en", {style: "percent"}) + '</td></tr>' +
										'<tr><th style="text-align: left;">30&ndash;34</th><td>' + (e.features[0].properties.sero30 / e.features[0].properties.count30).toLocaleString("en", {style: "percent"}) + '</td></tr>' +
										'<tr><th style="text-align: left;">35&ndash;39</th><td>' + (e.features[0].properties.sero35 / e.features[0].properties.count35).toLocaleString("en", {style: "percent"}) + '</td></tr></table>';
								}
								new mapboxgl.Popup()
									.setLngLat(e.lngLat)
									.setHTML(
										msgHeading.concat(msgSero)
									)
									.addTo(mapAdmin);
							});

							mapAdmin.on('click', 'admin-l3', function (e) {
								var msgHeading =
									'<strong>' + e.features[0].properties.lganame + '</strong> <em>' + e.features[0].properties.statename + '</em><br><br>' +
									'<table><tr><th style="text-align: left;">Total Population</th><td>' + e.features[0].properties.pop.toLocaleString("en") + '</td></tr>';
								var msgSero;
								if (e.features[0].properties.countTot == 0) {
									var msgSero = '<tr><th style="text-align: left;">Without Antibodies</th><td>No data</td></tr></table>';
								} else {
									var msgSero =
										'<tr><th style="text-align: left;">Without Antibodies</th><td>' + Math.round(e.features[0].properties.pop - (e.features[0].properties.pop * (e.features[0].properties.seroTot / e.features[0].properties.countTot))).toLocaleString("en") + '</td></tr></table>' +
										'<br><strong>Seroprevalence</strong>' + 
										'<table><tr><th style="text-align: left;">Overall</th><td>' + (e.features[0].properties.seroTot / e.features[0].properties.countTot).toLocaleString("en", {style: "percent"}) + '</td></tr>' +
										'<tr><th style="text-align: left;">25&ndash;29</th><td>' + (e.features[0].properties.sero25 / e.features[0].properties.count25).toLocaleString("en", {style: "percent"}) + '</td></tr>' +
										'<tr><th style="text-align: left;">30&ndash;34</th><td>' + (e.features[0].properties.sero30 / e.features[0].properties.count30).toLocaleString("en", {style: "percent"}) + '</td></tr>' +
										'<tr><th style="text-align: left;">35&ndash;39</th><td>' + (e.features[0].properties.sero35 / e.features[0].properties.count35).toLocaleString("en", {style: "percent"}) + '</td></tr></table>';
								}
								new mapboxgl.Popup()
									.setLngLat(e.lngLat)
									.setHTML(
										msgHeading.concat(msgSero)
									)
									.addTo(mapAdmin);
							});

							mapAdmin.on('mouseenter', 'admin-l2', function () {
								mapAdmin.getCanvas().style.cursor = 'pointer';
							});
							mapAdmin.on('mouseleave', 'admin-l2', function () {
								mapAdmin.getCanvas().style.cursor = '';
							});
							mapAdmin.on('mouseenter', 'admin-l3', function () {
								mapAdmin.getCanvas().style.cursor = 'pointer';
							});
							mapAdmin.on('mouseleave', 'admin-l3', function () {
								mapAdmin.getCanvas().style.cursor = '';
							});

							mapAdmin.scrollZoom.disable();

						});
					</script>
				</figure>


				<article style="max-width: 25vw; margin: 0 auto 0 0;">
					<div class="step step-box-map" data-index="23" style="padding-top: 4rem;">
						<p>The nine states with the lowest rates of seroprevalence are all in the southern part of the country:</p>
						<ol>
							<li>Cross River: 51%</li>
							<li>Benue: 52%</li>
							<li>Akwa Ibom: 53%</li>
							<li>Bayelsa: 53%</li>
							<li>Edo: 53%</li>
							<li>Rivers: 53%</li>
							<li>Abia: 54%</li>
							<li>Osun: 55%</li>
							<li>Delta: 55%</li>
						</ol>
					</div>
					<div class="step step-box-map" data-index="24">
						<p>Local Government Areas show wider variance</p>
					</div>
				</article>
				<article>
					<div class="step" data-index="26">
						<h1>Population Without Antibodies</h1>
					</div>
				</article>
				<article style="max-width: 25vw; margin: 0 auto 0 0; padding-top: 4rem;">
					<div class="step step-box-map" data-index="27">
						<p>Using height to represent the population of individuals without antibodies, we get a raw view of how many and where they are.</p>
					</div>
				</article>
				<article style="min-height: 100vh; width: 0%;">
				</article>
			</div>

			<div class="scrolly">
				<figure class="sticky step" data-index='1002' style="height: 100vh; top: 0;">
					<video id="dusty-street" playsinline muted loop style="object-fit: cover; height: 100vh; width: 100%;">
						<source src="dusty-street.mov" type="video/mp4">
					</video>
				</figure>

				<!--  step text   -->
				<article style="max-width: 67vw;">
					<div class='step' data-index='28'>
						<h1 style="color: white; font-size: 6rem;">My Process</h1>
						<div class="step-box" style="display: flex; flex-direction: row;">
							<ol>
								<li>Audience</li>
								<li>Vision for the Final Product</li>
								<li>Data Exploration</li>
								<li>Resources</li>
								<li>Methods</li>
							</ol>
						</div>
					</div>
				</article>
			</div>
			<div class="scrolly">
				<figure class="sticky" style="height: 50vh; top: 0; background-color: #f4f4f2;">
				</figure>
				<article style="max-width: 67vw;">
					<div class="step" data-index="29">
						<h1>Audience</h1>
						<div class="step-box">
							<p style="text-align: center;"><strong>That&rsquo;s you!</strong></p>
						</div>
						<div class="step-box" style="margin-top: 4rem; display: flex; flex-direction: row;">
							<div style="width: 40%; padding-right: 6rem; padding-top: 2rem;">
								<p>Whether it&rsquo;s public health messaging or most any form of communication, determining the audience for telling a data story is key to success.</p>
							</div>
							<div style="width: 60%;">
								<video id="youth-mask" playsinline muted loop style="object-fit: cover; width: 100%;">
									<source src="youth-mask.mov" type="video/mp4">
								</video>
							</div>
						</div>
					</div>
				</article>
				<article style="max-width: 67vw;">
					<div class="step" data-index="30">
						<h1>Vision for the<br>Final Product</h1>
						<div class="step-box" style="display: flex; flex-direction: row;">
							<div style="width: 15%;"></div>
							<div style="width: 70%;">
								<p>First, I decided what I would be working towards.</p>
								<p>What would best communicate the story of the science?</p>
								<p>This evolved throughout the project, but I&rsquo;d get lost if I didn&rsquo;t have a map of where I want to go.</p>
								<ul>
									<li>Visualizations
										<ul><li>how many?</li><li>what type?</li></ul>
									</li>
									<li>Medium</li>
									<li>Tone (emotion?)</li>
								</ul>
							</div>
							<div style="width: 15%;"></div>
						</div>
					</div>
				</article>
				<article style="max-width: 67vw;">
					<div class="step" data-index="31">
						<h1>Data Exploration</h1>
						<div class="step-box" style="display: flex; flex-direction: row;">
							<div style="width: 15%;"></div>
							<div style="width: 70%;">
								<p>I explored the data in table form and with desktop GIS software.</p>
								<p>What could I quickly learn about the situation?</p>
								<p>Will I need to clean or convert the data?</p>
								<p>Does this data give me everything I need to build the final product?</p>
								<p>Will I need to make accomodations due to any datasets?</p>
							</div>
							<div style="width: 15%;"></div>
						</div>
					</div>
				</article>
				<article style="max-width: 67vw;">
					<div class="step" data-index="32">
						<h1>Resources</h1>
						<div class="step-box" style="display: flex; flex-direction: row;">
							<div style="width: 50%; padding-right: 4rem;">
								<ul>
									<li>Sample data</li>
									<li>OpenStreetMap</li>
									<li>Population data and administrative boundaries from GRID&sup3; Nigeria</li>
									<li>ColorBrewer 2.0</li>
									<li>Creative Commons stock imagery</li>
									<li>Stock footage from Adobe</li>
							</div>
							<div style="width: 50%;">
								<p>Cross-platform, free and open source software!</p>
								<ul>
									<li>QGIS</li>
									<li>Visidata</li>
									<li>VS Code</li>
									<li>Python</li>
									<li>Pandas library</li>
									<li>csv2geojson</li>
									<li>HTML, CSS, Javascript</li>
									<li>Google Fonts</li>
									<li>enter-view.js</li>
									<li>D3.js</li>
									<li>Mapbox GL JS *</li>
									<li>Mapbox Geocoder *</li>
									<li>Mapbox Studio *</li>
									<li>Git and GitHub</li>
								</ul>
							</div>
						</div>
					</div>
				</article>
				<article style="max-width: 67vw;">
					<div class="step" data-index="33">
						<h1>Methods</h1>
						<div class="step-box" style="display: flex; flex-direction: row;">
							<div style="width: 15%;"></div>
							<div style="width: 70%;">
								<p><strong>Scriptable, reproducible processes</strong></p>
								<p>Automated update of visualizations with updated data</p>
								<p>Structured to accomodate data on three diseases</p>
							</div>
							<div style="width: 15%;"></div>
						</div>

						<div class="step-box" style="display: flex; flex-direction: row;">
							<div style="width: 60%; padding-right: 4em;">
								<div id="seroByAgeChart3"></div>
								<script>
									var seroByAgeChart3Loaded = 0;
								</script>
							</div>
							<div style="width: 40%;">
								<img src="mapping-3.png" style="max-width: 100%; max-height: 400px; float: right;">
							</div>
						</div>
						<div class="step-box" style="display: flex; flex-direction: row;">
							<div style="width: 15%;"></div>
							<div style="width: 70%;">
								<ol>
									<li>Python script to clean and convert sample data</li>
									<li>QGIS to convert population data</li>
									<li>Upload data to Mapbox to create vector tiles</li>
									<li>Build all four maps individually using Mapbox GL JS</li>
									<li>Build the Seroprevalence by Age chart with D3.js</li>
									<li>Try three different &ldquo;scrollytelling&rdquo; libraries</li>
									<li>Write accompanying text and build the data story</li>
								</ol>
							</div>
							<div style="width: 15%;"></div>
						</div>
					</div>
				</article>
			</div>

			<div class="scrolly">
				<figure class="sticky" style="height: 50vh; top: 0; background-color: #f4f4f2;">
				</figure>

				<article style="max-width: 67vw;">
					<div class='step' data-index='34' style="min-height: 75vh;">
						<div class="step-box" style="display: flex; flex-direction: row;">
							<div style="width: 67%;">
								<h1>Thank you!</h1>
								<p style="text-align: center;">Dave McLaughlin<br>dcm20@psu.edu</p>
							</div>
							<div style="width: 33%;">
								<img src="mclaughlin-photo.jpg" style="width: 100%;">
							</div>
						</div>
					</div>
				</article>
			</div>
		</section>
		

		<script>
			const container = d3.select('#scrolly-overlay');
			const stepSel = container.selectAll('.step');

			function init() {
				Stickyfill.add(d3.select('.sticky').node());

				enterView({
					selector: stepSel.nodes(),
					offset: 0.5,
					enter: el => {
						const index = +d3.select(el).attr('data-index');

						if (index == 1000) {
							document.getElementById("lagos-drone").play();
						}
						if (index == 1002) {
							document.getElementById("dusty-street").play();
						}
						if (index == 29) {
							document.getElementById("dusty-street").pause();
							document.getElementById("youth-mask").play();
						}
						if (index == 31) {
							document.getElementById("youth-mask").pause();
						}

						if (index == 1) {
							document.getElementById("lagos-drone").pause();

							if (seroByAgeChartLoaded == 0) {
								// set the dimensions and margins of the graph
								var margin = {top: 10, right: 10, bottom: 50, left: 70},
									width = 500 - margin.left - margin.right,
									height = 400 - margin.top - margin.bottom;
								// append the svg object to the body of the page
								var svg = d3.select("#seroByAgeChart")
								.append("svg")
									.attr("width", width + margin.left + margin.right)
									.attr("height", height + margin.top + margin.bottom)
								.append("g")
									.attr("transform",
										"translate(" + margin.left + "," + margin.top + ")");


								//Read the data
								d3.csv("summarySeroStats.csv",

								// Now I can use this dataset:
								function(data) {
									// Add X axis
									var x =  d3.scaleLinear()
										.domain( [40, 24])
										.range([ width, 0 ]);
									svg.append("g")
										.attr("transform", "translate(0," + height + ")")
										.attr("opacity", 0)
										.transition(500)
											.delay(250)
											.attr("opacity", 1)
										.call(d3.axisBottom(x));
									svg.append("text")
										.attr("x", (width / 2))
										.attr("y", height + 40)
										.text("Age");
									// Add Y axis
									var y = d3.scaleLinear()
										.domain( [ 0, 1 ])
										.range([ height, 0 ]);
									svg.append("g")
										.attr("opacity", 0)
										.transition(500)
											.delay(250)
											.attr("opacity", 1)
										.call(d3.axisLeft(y).tickFormat(d3.format(".0%")));
									svg.append("text")
										.attr("x", -250)
										.attr("y", -55)
										.attr("transform", "rotate(-90)")
										.text("Rate of Seroprevalence");

									function length(path) {
										return d3.create("svg:path").attr("d", path).node().getTotalLength();
									}
									line = d3.line()
										.x(function(d) { return x(d.age) })
										.y(function(d) { return y(d.rate) })
									const l = length(line(data));

									// create a tooltip
									var Tooltip = d3.select("#seroByAgeChart")
										.append("div")
										.style("display", "none")
										.attr("class", "tooltip")
										.style("padding", "5px")
									
									// Three function that change the tooltip when user hover / move / leave a cell
									var mouseover = function(d) {
										Tooltip
										.style("display", "block")
									}
									var mousemove = function(d) {
										Tooltip
										.html("<strong>Age " + d.age + "</strong><br>" + "Seroprevalence: " + d3.format(".0%")(d.rate))
										.style("position", "relative")
										.style("left", "300px")
										.style("top", "-150px")
									}
									var mouseleave = function(d) {
										Tooltip
										.style("display", "none")
									}

									// Add the points
									svg
										.append("g")
										.selectAll("dot")
										.data(data)
										.enter()
										.append("circle")
											.attr("cx", function(d) { return x(d.age) } )
											.attr("cy", function(d) { return y(d.rate) } )
											.attr("r", 6)
											.attr("fill", "#2c7fb8")
											.attr("opacity", 0)
											.on("mouseover", mouseover)
											.on("mousemove", mousemove)
											.on("mouseleave", mouseleave)
											.transition()
												.delay(500)
												.duration(500)
												.attr("opacity", 1)

									// Add the line
									svg.append("path")
										.datum(data)
										.attr("fill", "none")
										.attr("stroke", "#2c7fb8")
										.attr("stroke-width", 2.5)
										.attr("stroke-dasharray", `0,${l}`)
										.attr("d", line)
										.transition()
											.delay(1000)
											.duration(3000)
											.ease(d3.easeLinear)
											.attr("stroke-dasharray", `${l},${l}`);

								})
								seroByAgeChartLoaded = 1;
							}
						}

						if (index == 4) {
							map.flyTo({
								center: { lon: 6.8, lat: 9 },
								zoom: 6,
								pitch: 0,
								bearing: 0,
								speed: 0.1,
								essential: true
							});
						}
						if (index == 5) {
							map.flyTo({
								center: { lon: 3.41080, lat: 6.42857 },
								zoom: 10.96,
								pitch: 60,
								bearing: -74.4,
								speed: 0.3,
								essential: true
							});
						}
						if (index == 6) {
							map.flyTo({
								center: { lon: 4.86763, lat: 12.56716 },
								zoom: 8.11,
								pitch: 0.00,
								bearing: 0.00,
								speed: 0.3,
								essential: true
							});
						}
						if (index == 7) {
							map.flyTo({
								center: { lon: 11.78638, lat: 9.14011 },
								zoom: 10.5,
								pitch: 65.00,
								bearing: 176,
								speed: 0.2,
								essential: true
							});
						}
						if (index == 8) {
							map.flyTo({
								center: { lon: 7.36505, lat: 6.44924 },
								zoom: 9.75,
								pitch: 0.00,
								bearing: 180.00,
								speed: 0.3,
								essential: true
							});
						}
						if (index == 9) {
							map.flyTo({
								center: { lon: 8, lat: 9 },
								zoom: 6,
								pitch: 0,
								bearing: 0,
								speed: 0.3,
								essential: true
							});
						}
						if (index == 14) {
							mapPopDot.flyTo({
								center: { lon: 8, lat: 9 },
								zoom: 6,
								pitch: 0,
								bearing: 0,
								speed: 0.15,
								essential: true
							});
						}
						if (index == 16) {
							mapPopDot.flyTo({
								center: { lon: 6.8, lat: 9 },
								zoom: 6,
								pitch: 0,
								bearing: 0,
								speed: 0.1,
								essential: true
							});
						}
						if (index == 17) {
							mapPopDot.flyTo({
								center: { lon: 6.58761, lat: 5.03793 },
								zoom: 8.60,
								pitch: 0,
								bearing: 0,
								speed: 0.2,
								essential: true
							});
						}
						if (index == 18) {
							mapPopDot.easeTo({
								center: { lon: 12.50384, lat: 10.81411 },
								zoom: 8.5,
								pitch: 50,
								bearing: 8,
								duration: 50000,
								essential: true
							});
						}
						if (index == 19) {
							mapPopDot.flyTo({
								center: { lon: 8, lat: 9 },
								zoom: 6,
								pitch: 0,
								bearing: 0,
								speed: 0.5,
								essential: true
							});
						}
						if (index == 23) {
							mapAdmin.flyTo({
								center: { lon: 6.25, lat: 7.5 },
								zoom: 6.4,
								pitch: 0,
								bearing: 0,
								speed: 0.1,
								essential: true
							});
							mapAdmin.setPaintProperty(
								'admin-l2', 
								'fill-outline-color',
								[
									'step',
									['/', ['get', 'seroTot'], ['get', 'countTot']],
									'#f00',
									0.56,
									'rgba(255,255,255,0)'
								]
							);
						}
						if (index == 24) {
							mapAdmin.flyTo({
								center: { lon: 5.5, lat: 7.5 },
								zoom: 7,
								pitch: 0,
								bearing: 0,
								speed: 0.1,
								essential: true
							});
						}
						/*
						if (index == 25) {
							mapAdmin.setPaintProperty(
								'admin-l3', 
								'fill-outline-color',
								[
									'step',
									['/', ['get', 'seroTot'], ['get', 'countTot']],
									'#f00',
									0.35,
									'rgba(255,255,255,0)'
								]
							);
						}
						*/
						if (index == 26) {
							mapAdmin.setLayoutProperty(
								'country-label',
								'visibility',
								'none'
							);
							mapAdmin.setLayoutProperty(
								'state-label',
								'visibility',
								'none'
							);
							mapAdmin.setPaintProperty(
								'admin-l3',
								'fill-extrusion-height',
								[
									'*',
									[
										'*',
										['get', 'pop'],
										[
											'/',
											['get', 'seroTot'],
											['get', 'countTot']
										]
									],
									.2
								]
							);
							mapAdmin.flyTo({
								center: { lon: 6.53847, lat: 7.81216 },
								zoom: 6.74,
								pitch: 60.00,
								bearing: 20.00,
								speed: 0.1,
								essential: true
							});
						}
						if (index == 27) {
							mapAdmin.flyTo({
								center: { lon: 8, lat: 9 },
								zoom: 7,
								pitch: 60,
								bearing: -60,
								speed: 0.1,
								essential: true
							});
						}
						if (index == 33) {
							if (seroByAgeChart3Loaded == 0) {
								// set the dimensions and margins of the graph
								var margin = {top: 10, right: 10, bottom: 50, left: 70},
									width = 500 - margin.left - margin.right,
									height = 400 - margin.top - margin.bottom;
								// append the svg object to the body of the page
								var svg = d3.select("#seroByAgeChart3")
								.append("svg")
									.attr("width", width + margin.left + margin.right)
									.attr("height", height + margin.top + margin.bottom)
								.append("g")
									.attr("transform",
										"translate(" + margin.left + "," + margin.top + ")");


								//Read the data
								d3.csv("summarySeroStats.csv",

								// Now I can use this dataset:
								function(data) {
									// Add X axis
									var x =  d3.scaleLinear()
										.domain( [40, 24])
										.range([ width, 0 ]);
									svg.append("g")
										.attr("transform", "translate(0," + height + ")")
										.attr("opacity", 0)
										.transition(500)
											.delay(250)
											.attr("opacity", 1)
										.call(d3.axisBottom(x));
									svg.append("text")
										.attr("x", (width / 2))
										.attr("y", height + 40)
										.text("Age");
									// Add Y axis
									var y = d3.scaleLinear()
										.domain( [ 0, 1 ])
										.range([ height, 0 ]);
									svg.append("g")
										.attr("opacity", 0)
										.transition(500)
											.delay(250)
											.attr("opacity", 1)
										.call(d3.axisLeft(y).tickFormat(d3.format(".0%")));
									svg.append("text")
										.attr("x", -250)
										.attr("y", -55)
										.attr("transform", "rotate(-90)")
										.text("Rate of Seroprevalence");

									function length(path) {
										return d3.create("svg:path").attr("d", path).node().getTotalLength();
									}
									line = d3.line()
										.x(function(d) { return x(d.age) })
										.y(function(d) { return y(d.rate) })
									const l = length(line(data));
									lineB = d3.line()
										.x(function(d) { return x(d.age) })
										.y(function(d) { return y(d.rateB) })
									const lB = length(line(data));
									lineC = d3.line()
										.x(function(d) { return x(d.age) })
										.y(function(d) { return y(d.rateC) })
									const lC = length(line(data));

									// create a tooltip
									var Tooltip = d3.select("#seroByAgeChart3")
										.append("div")
										.style("display", "none")
										.attr("class", "tooltip")
										.style("padding", "5px")
									
									// Three function that change the tooltip when user hover / move / leave a cell
									var mouseover = function(d) {
										Tooltip
										.style("display", "block")
									}
									var mousemove = function(d) {
										Tooltip
										.html("<strong>Age " + d.age + "</strong><br>" + "Seroprevalence: " + d3.format(".0%")(d.rate))
										.style("position", "relative")
										.style("left", "300px")
										.style("top", "-150px")
									}
									var mouseleave = function(d) {
										Tooltip
										.style("display", "none")
									}

									// Add the points
									svg
										.append("g")
										.selectAll("dot")
										.data(data)
										.enter()
										.append("circle")
											.attr("cx", function(d) { return x(d.age) } )
											.attr("cy", function(d) { return y(d.rate) } )
											.attr("r", 6)
											.attr("fill", "#2c7fb8")
											.attr("opacity", 0)
											.on("mouseover", mouseover)
											.on("mousemove", mousemove)
											.on("mouseleave", mouseleave)
											.transition()
												.delay(500)
												.duration(500)
												.attr("opacity", 1)
									// Add the line
									svg.append("path")
										.datum(data)
										.attr("fill", "none")
										.attr("stroke", "#2c7fb8")
										.attr("stroke-width", 2.5)
										.attr("stroke-dasharray", `0,${l}`)
										.attr("d", line)
										.transition()
											.delay(1000)
											.duration(3000)
											.ease(d3.easeLinear)
											.attr("stroke-dasharray", `${l},${l}`);
									// Add the points
									svg
										.append("g")
										.selectAll("dot")
										.data(data)
										.enter()
										.append("circle")
											.attr("cx", function(d) { return x(d.age) } )
											.attr("cy", function(d) { return y(d.rateB) } )
											.attr("r", 6)
											.attr("fill", "#fc8d62")
											.attr("opacity", 0)
											.on("mouseover", mouseover)
											.on("mousemove", mousemove)
											.on("mouseleave", mouseleave)
											.transition()
												.delay(5500)
												.duration(500)
												.attr("opacity", 1)
									// Add the line
									svg.append("path")
										.datum(data)
										.attr("fill", "none")
										.attr("stroke", "#fc8d62")
										.attr("stroke-width", 2.5)
										.attr("stroke-dasharray", `0,${lB}`)
										.attr("d", lineB)
										.transition()
											.delay(6000)
											.duration(3000)
											.ease(d3.easeLinear)
											.attr("stroke-dasharray", `${lB},${lB}`);
									// Add the points
									svg
										.append("g")
										.selectAll("dot")
										.data(data)
										.enter()
										.append("circle")
											.attr("cx", function(d) { return x(d.age) } )
											.attr("cy", function(d) { return y(d.rateC) } )
											.attr("r", 6)
											.attr("fill", "#66c2a5")
											.attr("opacity", 0)
											.on("mouseover", mouseover)
											.on("mousemove", mousemove)
											.on("mouseleave", mouseleave)
											.transition()
												.delay(6500)
												.duration(500)
												.attr("opacity", 1)
									// Add the line
									svg.append("path")
										.datum(data)
										.attr("fill", "none")
										.attr("stroke", "#66c2a5")
										.attr("stroke-width", 2.5)
										.attr("stroke-dasharray", `0,${lC}`)
										.attr("d", lineC)
										.transition()
											.delay(7000)
											.duration(3000)
											.ease(d3.easeLinear)
											.attr("stroke-dasharray", `${lC},${lC}`);


								})
								seroByAgeChart3Loaded = 1;
							}
						}
					},
					exit: el => {
						let index = +d3.select(el).attr('data-index');

						if (index == 1) {
							document.getElementById("lagos-drone").play();
						}

						index = Math.max(0, index - 1);

						if (index == 4) {
							map.flyTo({
								center: { lon: 6.8, lat: 9 },
								zoom: 6,
								pitch: 0,
								bearing: 0,
								speed: 0.5,
								essential: true
							});
						}
						if (index == 5) {
							map.flyTo({
								center: { lon: 3.41080, lat: 6.42857 },
								zoom: 10.96,
								pitch: 60,
								bearing: -74.4,
								speed: 0.5,
								essential: true
							});
						}
						if (index == 6) {
							map.flyTo({
								center: { lon: 4.86763, lat: 12.56716 },
								zoom: 8.11,
								pitch: 0.00,
								bearing: 0.00,
								speed: 0.5,
								essential: true
							});
						}
						if (index == 7) {
							map.flyTo({
								center: { lon: 11.78638, lat: 9.14011 },
								zoom: 10.5,
								pitch: 65.00,
								bearing: 176,
								speed: 0.5,
								essential: true
							});
						}
						if (index == 8) {
							map.flyTo({
								center: { lon: 7.36505, lat: 6.44924 },
								zoom: 9.75,
								pitch: 0.00,
								bearing: 180.00,
								speed: 0.5,
								essential: true
							});
						}
						if (index == 9) {
							map.flyTo({
								center: { lon: 8, lat: 9 },
								zoom: 6,
								pitch: 0,
								bearing: 0,
								speed: 0.5,
								essential: true
							});
						}
						if (index == 14) {
							mapPopDot.flyTo({
								center: { lon: 8, lat: 9 },
								zoom: 6,
								pitch: 0,
								bearing: 0,
								speed: 0.5,
								essential: true
							});
						}
						if (index == 16) {
							mapPopDot.flyTo({
								center: { lon: 6.8, lat: 9 },
								zoom: 6,
								pitch: 0,
								bearing: 0,
								speed: 0.5,
								essential: true
							});
						}
						if (index == 17) {
							mapPopDot.easeTo({
								center: { lon: 6.58761, lat: 5.03793 },
								zoom: 8.60,
								pitch: 0,
								bearing: 0,
								duration: 2000,
								essential: true
							});
						}
						if (index == 18) {
							mapPopDot.flyTo({
								center: { lon: 12.50384, lat: 10.81411 },
								zoom: 8.5,
								pitch: 50,
								bearing: 8,
								speed: 0.5,
								essential: true
							});
						}
						if (index == 19) {
							mapPopDot.flyTo({
								center: { lon: 8, lat: 9 },
								zoom: 6,
								pitch: 0,
								bearing: 0,
								speed: 0.5,
								essential: true
							});
						}
					}
				});
			}

			init();
		</script>
	</body>
</html>